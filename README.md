# جستجوی نام — ربات تلگرام

ربات تلگرام برای جستجوی نام جاویدنام‌هایی که توسط رژیم ایران کشته شده‌اند. داده‌ها از کانال [@RememberTheirNames](https://t.me/RememberTheirNames) تهیه می‌شوند.

## پیش‌نیازها

- [Bun](https://bun.sh)
- [MongoDB](https://www.mongodb.com) (محلی یا از راه دور)
- [Meilisearch](https://www.meilisearch.com) (موتور جستجو؛ محلی یا در Docker)
- توکن ربات از [@BotFather](https://t.me/BotFather)

## نصب

```bash
bun install
```

## تنظیمات

فایل `.env` در ریشهٔ پروژه بسازید (از `.env.example` کپی کنید):

```
BOT_TOKEN=توکن_ربات_از_BotFather
MONGO_URI=mongodb://localhost:27017/namesearch
MEILI_URL=http://localhost:7700
MEILI_MASTER_KEY=   # اختیاری؛ اگر Meilisearch با کلید اصلی اجرا شود، همین را قرار دهید
ADMIN_ID=شناسه_عددی_تلگرام_مدیر  # اختیاری؛ برای افزودن رکورد با فوروارد
```

## داده

- فایل `data/result.json` را با خروجی صادرشدهٔ کانال تلگرام پر کنید.
- عکس‌ها در `data/photos/` قرار گیرند.

پس از قرار دادن `result.json`، یک بار import را اجرا کنید. این کار داده را در MongoDB ذخیره و در Meilisearch هم ایندکس می‌کند. در صورت به‌روزرسانی این فایل، با اجرای ربات واردسازی مجدد به‌صورت خودکار انجام می‌شود.

```bash
bun run import
```

## اجرا

**اجرای محلی:**

```bash
bun run start
```

یا:

```bash
bun run src/index.ts
```

**اجرای با Docker:**

```bash
docker compose up --build
```

سرویس‌ها: MongoDB، Meilisearch، ربات. متغیرهای `BOT_TOKEN` و در صورت نیاز `MEILI_MASTER_KEY` را در فایل `.env` تنظیم کنید.

## دستورات ربات

| دستور | توضیح |
|--------|--------|
| `/start` | پیام خوش‌آمد |
| `/help` | راهنما |
| ارسال متن ساده | جستجو در نام، مکان و تاریخ |

هر متنی بفرستید (نام، شهر، یا تاریخ)؛ ربات با Meilisearch در نام، مکان و تاریخ جستجو می‌کند. جستجو فازی است (غلط‌املایی و چندکلمه‌ای مثل «امیر تهران» پشتیبانی می‌شود). نیم‌فاصله و تفاوت املای عربی/فارسی هم در نظر گرفته می‌شود. نتایج بیش از ده تا با صفحه‌بندی و دکمهٔ «صفحه قبل» / «صفحه بعد» نمایش داده می‌شوند.

**افزودن رکورد (مدیر):** اگر `ADMIN_ID` تنظیم شده باشد، مدیر می‌تواند با فوروارد کردن پیامِ عکس‌دارِ کانال به ربات، یک رکورد جدید اضافه کند.

## پروژهٔ متن‌باز

این پروژه برای شفافیت و امنیت کاربران قابل بررسی است. هیچ داده‌ای از کاربران (شناسه، جستجو، تاریخچه) ذخیره یا ثبت نمی‌شود.
